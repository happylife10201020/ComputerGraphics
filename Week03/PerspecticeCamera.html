<!DOCTYPE html>
<html>
    <head>
        <meta charset = 'utf-8'>
        <title>ThreeJSProgram-01</title>
        <script src = "https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
        <style></style>
    </head>

    <body>
        
        <script>
            let scene = new THREE.Scene() ;

            let camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100) ;
            let new_camera = new THREE.OrthographicCamera(window.innerWidth / -50, window.innerWidth / 50, window.innerHeight / 50, window.innerHeight / -50, 0, 150) ;
            let helper_camera = new THREE.CameraHelper(new_camera) ;

            camera.position.set(-100, 100, 100) ;
            camera.lookAt(0, 0, 0) ;

            new_camera.position.x= 96 ;
            new_camera.lookAt(0, 0, 0) ;

            scene.add(helper_camera) ;

            //Make Lighting
            let spotLight = new THREE.SpotLight(0xffffff) ;
            spotLight.position.set(-40, 60, -10) ;
            spotLight.castShadow = true ;
            scene.add(spotLight) ;

            //Make some objects
            const sun_geometry = new THREE.SphereGeometry(15, 32, 16) ;
            const sun_material = new THREE.MeshPhongMaterial( {color: 0xff7700}) ;
            const sun = new THREE.Mesh(sun_geometry, sun_material) ;
            scene.add(sun) ;

            let cubeGeometry = new THREE.BoxGeometry(4, 4, 4) ;
            let cubeMaterial = new THREE.MeshLambertMaterial({color: 0x00FF77}) ;
            let cube = new THREE.Mesh(cubeGeometry, cubeMaterial) ;
            cube.position.x = 100 ;
            scene.add(cube) ;

            //Rendering
            renderer = new THREE.WebGLRenderer() ;
            renderer.setSize(window.innerWidth, window.innerHeight) ;
            renderer.shadowMap.enabled = true ;
            document.body.appendChild(renderer.domElement) ;

            //AnimationFrame
            let step = 0 ;
            renderScene() ;
            function renderScene() {
                cube.rotation.x += 0.01 ;
                cube.rotation.y += 0.01 ;
                cube. rotation.z += 0.01 ;
                step += 0.02 ;
                sun.position.x = 20 + 10 * Math.cos(step) ;
                sun.position.y = 2 + 10 * Math.abs(Math.sin(step)) ;
                requestAnimationFrame(renderScene) ;
                renderer.render(scene, camera) ;
            }

            //Array camera
            const AMOUNT = 3 ;
            const cameras = [] ;
            const WIDTH = window.innerWidth / AMOUNT ;
            const HEIGHT = window.innerHeight / AMOUNT ;

            for(let y = 0; y<AMOUNT; y++){
                for(let x = 0; x<AMOUNT; x++){
                    const cam = new THREE.PerspectiiveCamera(45, WIDTH / HEIGHT, 0.1, 500) ;
                    cam.position.set(30 * (x - 1), 30 * (1 - y), 50) ;
                    cam.lookAt(scene.position) ;

                    cam.viewport = new THREE.Vector4(x * WIDTH, y * HEIGHT, WIDTH, HEIGHT) ;
                    cameras.push(cam) ;

                    cameras.forEach(cam => {
                        const v = cam.viewport ;
                        renderer.setViewport(v.x, v.y, v.z, v.w) ;
                        renderer.setScissor(v.x, v.y, v.z, v.w) ;
                        renderer.setScissorTest(true) ;
                        renderer.render(scene, cam) ;
                    })
                }
            }


            //Making shadow
            init() ;
            function init(){
                renderer.shadowMap.enabled = true ;

                let spotLight = new THREE.SpotLight(0xffffff) ;
                spotLight.position.set(-40, 60, -40) ;
                spotLight.castShadow = true ;
                scene.add(spotLight) ;

                let planeGeo = new THREE.PlaneGeometry(400, 200, 10, 10) ;
                let planeMat = new THREE.MeshLambertMaterial({color: 0xffffff}) ;
                let plane = new THREE.Mesh(planeGeo, planeMat) ;
                plane.rotation.x = -Math.PI / 2 ;
                plane.position.y = -25 ;
                plane.receiveShadow = true ;
                scene.add(plane) ;

                cube.castShadow = true ; 
            }

        </script>
    </body>
</html>